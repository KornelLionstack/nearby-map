window.nearby_map=window.nearby_map||{},window.nearby_map_object=window.nearby_map_object||{},window.nearby_origins=window.nearby_origins||{},document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll('[class*="proximity_place_"]'),n="undefined"!=typeof ajaxurl?ajaxurl:"undefined"!=typeof cspm_nearby_map?cspm_nearby_map.ajax_url:"/wp-admin/admin-ajax.php";function a(e){const n=new Map([["á","a"],["é","e"],["í","i"],["ó","o"],["ö","o"],["ő","o"],["ú","u"],["ü","u"],["ű","u"],["Á","a"],["É","e"],["Í","i"],["Ó","o"],["Ö","o"],["Ő","o"],["Ú","u"],["Ü","u"],["Ű","u"]]);return e.toLowerCase().split("").map(e=>n.get(e)||e).join("").replace(/[\s\-]+/g,"_").replace(/[^a-z0-9_]/g,"").trim()}e.forEach(e=>{e.addEventListener("click",function(){const e=this.dataset.proximityName,t=this.dataset.mapId,o=a(e);fetch(n+"?action=get_custom_nearby_locations").then(e=>e.json()).then(e=>{const n=e.filter(e=>a(e.type)===o);0===n.length&&console.warn(`Nincs találat a '${o}' slug-hoz.`),function(e,n){const t="codespacing_progress_map_"+n,o=document.getElementById(t);if(!o)return console.error(`Nem található a térkép elem: ${t}`);const r=parseFloat(o.dataset.lat||47.4555962),s=parseFloat(o.dataset.lng||19.0435047),i=parseInt(o.dataset.zoom||13),l=new google.maps.Map(o,{center:{lat:r,lng:s},zoom:i,mapTypeId:"roadmap"});window.nearby_map[n]=l,window.nearby_map_object[n]=l,window.nearby_origins[n]=new google.maps.LatLng(r,s);const p=new google.maps.DirectionsService,c=new google.maps.DirectionsRenderer({suppressMarkers:!0});c.setMap(l);const m=new google.maps.InfoWindow,d="undefined"!=typeof cspm_nearby_map&&cspm_nearby_map.place_markers_file_url?cspm_nearby_map.place_markers_file_url:"";e.forEach(e=>{const t=d?{url:d+a(e.type)+".svg",scaledSize:new google.maps.Size(40,40)}:null,o=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},map:l,title:e.name,...t?{icon:t}:{}});o.addListener("click",()=>{c.setMap(l),c.set("directions",null),p.route({origin:window.nearby_origins[n],destination:{lat:e.lat,lng:e.lng},travelMode:google.maps.TravelMode.DRIVING},(a,t)=>{if("OK"===t){c.setDirections(a);const t=a.routes[0].legs[0],o=t.steps.map(e=>`<li>${e.instructions.replace(/<div.*?>|<\/div>/g,"")} - ${e.distance.text}</li>`).join(""),r="undefined"!=typeof cspm_nearby_map?cspm_nearby_map.google_map_link_text:"Megnyitás Google Térképen",s=`https://www.google.com/maps/dir/?api=1&origin=${window.nearby_origins[n].lat()},${window.nearby_origins[n].lng()}&destination=${e.lat},${e.lng}`;m.setContent(`<strong>${e.name}</strong><br>${t.duration.text} (${t.distance.text})<ol>${o}</ol><a href="${s}" target="_blank" rel="noopener" class="cspm-gmaps-button">${r}</a>`)}else m.setContent("Nincs elérhető útvonal");m.open(l,o)})})})}(n,t)}).catch(e=>console.error("Helyek betöltésekor hiba történt:",e))})})});
