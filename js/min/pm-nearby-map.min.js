window.nearby_map=window.nearby_map||{},window.nearby_map_object=window.nearby_map_object||{},window.nearby_origins=window.nearby_origins||{},document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll('[class*="proximity_place_"]'),a=document.querySelectorAll(".cspm_back_to_nearby_cats"),n="undefined"!=typeof ajaxurl?ajaxurl:"undefined"!=typeof cspm_nearby_map?cspm_nearby_map.ajax_url:"/wp-admin/admin-ajax.php";function o(e){const a=new Map([["á","a"],["é","e"],["í","i"],["ó","o"],["ö","o"],["ő","o"],["ú","u"],["ü","u"],["ű","u"],["Á","a"],["É","e"],["Í","i"],["Ó","o"],["Ö","o"],["Ő","o"],["Ú","u"],["Ü","u"],["Ű","u"]]);return e.toLowerCase().split("").map(e=>a.get(e)||e).join("").replace(/[\s\-]+/g,"_").replace(/[^a-z0-9_]/g,"").trim()}function t(e,a,n=!1){const t="codespacing_progress_map_"+a,s=document.getElementById(t);if(!s)return console.error(`Nem található a térkép elem: ${t}`);const l=parseFloat(s.dataset.lat||47.4555962),r=parseFloat(s.dataset.lng||19.0435047),i=parseInt(s.dataset.zoom||13),c=new google.maps.Map(s,{center:{lat:l,lng:r},zoom:i,mapTypeId:"roadmap"});window.nearby_map[a]=c,window.nearby_map_object[a]=c,window.nearby_origins[a]=new google.maps.LatLng(l,r);const p=new google.maps.DirectionsService,m=new google.maps.DirectionsRenderer({suppressMarkers:!0});m.setMap(c);const _=new google.maps.InfoWindow,d={position:{lat:l,lng:r},map:c};"undefined"!=typeof cspm_nearby_map&&cspm_nearby_map.geoloc_marker_url&&(d.icon={url:cspm_nearby_map.geoloc_marker_url,scaledSize:new google.maps.Size(40,40)}),new google.maps.Marker(d),c.addListener("click",()=>{m.set("directions",null),_.close()});const g="undefined"!=typeof cspm_nearby_map&&cspm_nearby_map.place_markers_file_url?cspm_nearby_map.place_markers_file_url:"",y=[];return e.forEach(e=>{const n=g?{url:g+o(e.type)+".svg",scaledSize:new google.maps.Size(40,40)}:null,t=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},map:c,title:e.name,...n?{icon:n}:{}});y.push(t),t.addListener("click",()=>{m.setMap(c),m.set("directions",null),p.route({origin:window.nearby_origins[a],destination:{lat:e.lat,lng:e.lng},travelMode:google.maps.TravelMode.DRIVING},(e,a)=>{"OK"===a&&m.setDirections(e)});const n=new google.maps.DistanceMatrixService,o=[{mode:google.maps.TravelMode.DRIVING,label:"Autóval"},{mode:google.maps.TravelMode.WALKING,label:"Gyalog"},{mode:google.maps.TravelMode.BICYCLING,label:"Kerékpárral"},{mode:google.maps.TravelMode.TRANSIT,label:"Tömegközlekedéssel"}],s=[];let l=o.length;o.forEach(o=>{n.getDistanceMatrix({origins:[window.nearby_origins[a]],destinations:[{lat:e.lat,lng:e.lng}],travelMode:o.mode},(n,r)=>{if("OK"===r&&"OK"===n.rows[0].elements[0].status){const e=n.rows[0].elements[0];s.push(`${o.label}: ${e.duration.text} (${e.distance.text})`)}if(l--,0===l){const n="undefined"!=typeof cspm_nearby_map?cspm_nearby_map.google_map_link_text:"Megnyitás Google Térképen",o=`https://www.google.com/maps/dir/?api=1&origin=${window.nearby_origins[a].lat()},${window.nearby_origins[a].lng()}&destination=${e.lat},${e.lng}`;_.setContent(`<strong>${e.name}</strong><br>`+s.join("<br>")+`<br><a href="${o}" target="_blank" rel="noopener" class="cspm-gmaps-button">${n}</a>`),_.open(c,t)}})})})}),n&&y.length>0&&google.maps.event.addListenerOnce(c,"idle",()=>{google.maps.event.trigger(y[0],"click")}),{map:c,markers:y}}e.forEach(e=>{e.addEventListener("click",function(){const e=this.dataset.proximityName,a=this.dataset.mapId,s=o(e);fetch(n+"?action=get_custom_nearby_locations").then(e=>e.json()).then(n=>{const l=n.filter(e=>o(e.type)===s);0===l.length&&console.warn(`Nincs találat a '${s}' slug-hoz.`),t(l,a),function(e,a,n,o){const s=document.getElementById("cspm_nearby_places_list_"+a);if(!s)return;s.style.display="block";const l="undefined"!=typeof cspm_nearby_map&&cspm_nearby_map.place_markers_file_url?cspm_nearby_map.place_markers_file_url:"",r=s.querySelector(".cspm_nearby_cat_list_img");r&&(r.src=l+o+".svg");const i=s.querySelector(".cspm_nearby_cat_list_name");i&&(i.textContent=n);const c=s.querySelector(".cspm_nbr_places_found");c&&(c.textContent=e.length);const p=s.querySelector(".cspm_nearby_location_list_items_container_"+a);p&&(p.innerHTML="");document.querySelectorAll(".proximity_place_"+a).forEach(e=>e.style.display="none"),e.forEach(e=>{const n=document.createElement("div");n.className="cspm_nearby_location_list_item",n.innerHTML=`<div class="cspm_location_list_item_details"><span class="cspm_place_name_list">${e.name}</span>`+(e.address?`<span class="cspm_place_vicinity_list">${e.address}</span>`:"")+'<div class="cspm_place_travel_info"></div></div>',p&&p.appendChild(n),n.addEventListener("click",()=>{document.querySelectorAll(".cspm_nearby_location_list_item").forEach(e=>e.classList.remove("active")),n.classList.add("active"),t([e],a,!0)});const o=n.querySelector(".cspm_place_travel_info");if(o){const n=new google.maps.DistanceMatrixService,t=[{mode:google.maps.TravelMode.DRIVING,label:"Autóval"},{mode:google.maps.TravelMode.WALKING,label:"Gyalog"},{mode:google.maps.TravelMode.BICYCLING,label:"Kerékpárral"},{mode:google.maps.TravelMode.TRANSIT,label:"Tömegközlekedéssel"}];let s=t.length;const l=[];t.forEach(t=>{n.getDistanceMatrix({origins:[window.nearby_origins[a]],destinations:[{lat:e.lat,lng:e.lng}],travelMode:t.mode},(n,r)=>{if("OK"===r&&"OK"===n.rows[0].elements[0].status){const e=n.rows[0].elements[0];l.push(`${t.label}: ${e.duration.text} (${e.distance.text})`)}if(0===--s){const n="undefined"!=typeof cspm_nearby_map?cspm_nearby_map.google_map_link_text:"Megnyitás Google Térképen",t=`https://www.google.com/maps/dir/?api=1&origin=${window.nearby_origins[a].lat()},${window.nearby_origins[a].lng()}&destination=${e.lat},${e.lng}`;o.innerHTML=l.join("<br>")+`<br><a href="${t}" target="_blank" rel="noopener" class="cspm-gmaps-button">${n}</a>`}})})}})}(l,a,e,s)}).catch(e=>console.error("Helyek betöltésekor hiba történt:",e))})}),a.forEach(e=>{e.addEventListener("click",function(){const e=this.dataset.mapId,a=document.getElementById("cspm_nearby_places_list_"+e);a&&(a.style.display="none"),document.querySelectorAll(".proximity_place_"+e).forEach(e=>e.style.display="inline-block"),t([],e)})}),window.addEventListener("load",function(){"undefined"!=typeof nearby_map_object&&"undefined"!=typeof nearby_origins&&Object.keys(nearby_map_object).forEach(function(e){const a=nearby_map_object[e],n=nearby_origins[e];if(a&&n){const e="undefined"!=typeof cspm_nearby_map&&cspm_nearby_map.geoloc_marker_url?cspm_nearby_map.geoloc_marker_url:null,o={position:n,map:a};e&&(o.icon={url:e,scaledSize:new google.maps.Size(40,40)}),new google.maps.Marker(o)}})})});
