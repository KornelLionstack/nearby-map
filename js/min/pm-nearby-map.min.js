window.nearby_map=window.nearby_map||{},window.nearby_map_object=window.nearby_map_object||{},window.origin=window.origin||{};let customLocations=[],customMap,customMarkers=[];function addCustomMarker(a,t,o,n){if(customMap){var r,s,a={lat:parseFloat(a),lng:parseFloat(t)};let e;return e=google.maps.marker&&google.maps.marker.AdvancedMarkerElement?(t={map:customMap,position:a,title:o||""},(r=getIconByType(n))&&((s=document.createElement("img")).src=r,s.width=24,s.height=24,t.content=s),new google.maps.marker.AdvancedMarkerElement(t)):new google.maps.Marker({position:a,map:customMap,title:o||"",icon:getIconByType(n)}),customMarkers.push(e),e}}function clearCustomMarkers(){customMarkers.forEach(e=>{"function"==typeof e.setMap?e.setMap(null):e.map=null}),customMarkers=[]}function loadNearbyLocations(a){var e="undefined"!=typeof cspm_nearby_map&&cspm_nearby_map.ajax_url?cspm_nearby_map.ajax_url:"/wp-admin/admin-ajax.php";fetch(e+"?action=get_custom_nearby_locations").then(e=>e.json()).then(e=>{e=a?e.filter(e=>slugifyType(e.type)===a):e;clearCustomMarkers(),e.forEach(e=>{e.lat&&e.lng&&addCustomMarker(parseFloat(e.lat),parseFloat(e.lng),e.name||"",slugifyType(e.type||""))})}).catch(e=>{console.error("Helyek betöltése sikertelen:",e)})}function slugifyType(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().replace(/[\s-]+/g,"_").replace(/[^a-z0-9_]/g,"").replace(/^_+|_+$/g,"")}function onReady(e){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}function waitForGoogleMaps(e,a=20){"undefined"!=typeof google&&google.maps?e():0<a&&setTimeout(function(){waitForGoogleMaps(e,a-1)},500)}function initCustomNearbyMap(){let e=document.getElementById("map");var a;(e=e||document.querySelector('.cspm_map_container div[id^="codespacing_progress_map_"]'))&&(a=new google.maps.Map(e,{center:{lat:47.4979,lng:19.0402},zoom:13}),customMap=a,a="undefined"!=typeof cspm_nearby_map&&cspm_nearby_map.ajax_url?cspm_nearby_map.ajax_url:"/wp-admin/admin-ajax.php",fetch(a+"?action=get_custom_nearby_locations").then(e=>e.json()).then(e=>{console.log("Loaded locations from JSON:",e),renderCustomTypeFilter(customLocations=Array.isArray(e)?e.map(e=>Object.assign({},e,{slug:slugifyType(e.type||"")})):[]),bindCategoryHover(),customLocations.forEach(e=>{e.lat&&e.lng&&addCustomMarker(e.lat,e.lng,e.name||"Hely",e.slug)})}).catch(e=>console.error("Hiba a helyek betöltésekor:",e)))}onReady(function(){waitForGoogleMaps(initCustomNearbyMap)});let typeAliases={bowling:"bowling_alley",bevasarlas_es_kiskereskedelem:"shopping_mall",kozlekedes:"bus_station",egeszsegugyi_letesitmenyek:"hospital",oktatasi_intezmenyek:"school",jszakai_let__klub:"night_club",sport_es_rekreacio:"stadium",ttermek:"restaurant",kulturalis_helyszinek:"museum",kavezok:"cafe"};function getIconByType(e){return"undefined"!=typeof cspm_nearby_map&&cspm_nearby_map.place_markers_file_url?(e=typeAliases[e]||e,cspm_nearby_map.place_markers_file_url+e+".png"):null}function getCustomTypesFromJSON(e){let a=new Map;return e.forEach(e=>{e.slug&&e.type&&!a.has(e.slug)&&a.set(e.slug,e.type)}),a}function renderCustomTypeFilter(e){var a=document.querySelector("#cspm-filter");if(a){e=getCustomTypesFromJSON(e);let t='<select id="custom-type-selector"><option value="">– Összes típus –</option>';e.forEach((e,a)=>{t+=`<option value="${a}">${e}</option>`}),t+="</select>",a.innerHTML=t,document.querySelector("#custom-type-selector").addEventListener("change",function(){loadNearbyLocations(this.value)})}}function showFilteredLocations(a){var e=a?customLocations.filter(e=>e.slug===a):customLocations;clearCustomMarkers(),e.forEach(e=>{addCustomMarker(e.lat,e.lng,e.name,e.slug)})}function bindCategoryHover(){document.querySelectorAll(".cspm_nearby_cat_holder").forEach(e=>{let a=slugifyType(e.getAttribute("id")||e.dataset.proximityName||"");e.addEventListener("mouseenter",()=>{loadNearbyLocations(a)}),e.addEventListener("mouseleave",()=>{loadNearbyLocations("")}),e.addEventListener("click",()=>{loadNearbyLocations(a)})})}function cspm_nearby_locations(e,a,t,o,n,r){loadNearbyLocations(slugifyType(a||""))}
