window.nearby_map=window.nearby_map||{},window.nearby_map_object=window.nearby_map_object||{},window.origin=window.origin||{};let customMap,customLocations=[],customMarkers=[];function addCustomMarker(e,t,o,a){if(!customMap)return;const n=new google.maps.Marker({position:{lat:parseFloat(e),lng:parseFloat(t)},map:customMap,title:o||"",icon:getIconByType(a)});return customMarkers.push(n),n}function clearCustomMarkers(){customMarkers.forEach(e=>e.setMap(null)),customMarkers=[]}function slugifyType(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().replace(/[\s-]+/g,"_").replace(/[^a-z0-9_]/g,"").replace(/^_+|_+$/g,"")}function onReady(e){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}function initCustomNearbyMap(){let e=document.getElementById("map");if(e||(e=document.querySelector('.cspm_map_container div[id^="codespacing_progress_map_"]')),!e)return;const t=new google.maps.Map(e,{center:{lat:47.4979,lng:19.0402},zoom:13});customMap=t;const o="undefined"!=typeof cspm_nearby_map&&cspm_nearby_map.ajax_url?cspm_nearby_map.ajax_url:"/wp-admin/admin-ajax.php";fetch(o+"?action=get_custom_nearby_locations").then(e=>e.json()).then(e=>{customLocations=Array.isArray(e)?e.map(e=>Object.assign({},e,{slug:slugifyType(e.type||"")})):[],renderCustomTypeFilter(customLocations),bindCategoryHover(),customLocations.forEach(e=>{e.lat&&e.lng&&addCustomMarker(e.lat,e.lng,e.name||"Hely",e.slug)})}).catch(e=>console.error("Hiba a helyek betöltésekor:",e))}onReady(function(){"undefined"!=typeof google&&google.maps&&initCustomNearbyMap()});const typeAliases={bowling:"bowling_alley",bevasarlas_es_kiskereskedelem:"shopping_mall",kozlekedes:"bus_station",egeszsegugyi_letesitmenyek:"hospital",oktatasi_intezmenyek:"school",jszakai_let__klub:"night_club",sport_es_rekreacio:"stadium",ttermek:"restaurant",kulturalis_helyszinek:"museum",kavezok:"cafe"};function getIconByType(e){if("undefined"!=typeof cspm_nearby_map&&cspm_nearby_map.place_markers_file_url){const t=typeAliases[e]||e;return cspm_nearby_map.place_markers_file_url+t+".png"}return null}function getCustomTypesFromJSON(e){const t=new Map;return e.forEach(e=>{e.slug&&e.type&&!t.has(e.slug)&&t.set(e.slug,e.type)}),t}function renderCustomTypeFilter(e){const t=document.querySelector("#cspm-filter");if(!t)return;const o=getCustomTypesFromJSON(e);let a='<select id="custom-type-selector"><option value="">– Összes típus –</option>';o.forEach((e,t)=>{a+=`<option value="${t}">${e}</option>`}),a+="</select>",t.innerHTML=a,document.querySelector("#custom-type-selector").addEventListener("change",function(){showFilteredLocations(this.value)})}function showFilteredLocations(e){const t=e?customLocations.filter(t=>t.slug===e):customLocations;clearCustomMarkers(),t.forEach(e=>{addCustomMarker(e.lat,e.lng,e.name,e.slug)})}function bindCategoryHover(){document.querySelectorAll(".cspm_nearby_cat_holder").forEach(e=>{const t=slugifyType(e.getAttribute("id")||e.dataset.proximityName||"");e.addEventListener("mouseenter",()=>{showFilteredLocations(t)}),e.addEventListener("mouseleave",()=>{showFilteredLocations("")})})}
