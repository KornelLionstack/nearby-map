let customLocations=[];function slugifyType(e){return e.toLowerCase().trim().replace(/[\s-]+/g,"_").replace(/[^a-z0-9_]/g,"").replace(/^_+|_+$/g,"")}function initCustomNearbyMap(){var e=document.getElementById("map");if(e){let t=new google.maps.Map(e,{center:{lat:47.4979,lng:19.0402},zoom:13});e="undefined"!=typeof cspm_nearby_map&&cspm_nearby_map.ajax_url?cspm_nearby_map.ajax_url:"/wp-admin/admin-ajax.php";fetch(e+"?action=get_custom_nearby_locations").then(e=>e.json()).then(e=>{renderCustomTypeFilter(customLocations=Array.isArray(e)?e.map(e=>Object.assign({},e,{slug:slugifyType(e.type||"")})):[]),customLocations.forEach(e=>{e.lat&&e.lng&&new google.maps.Marker({position:{lat:parseFloat(e.lat),lng:parseFloat(e.lng)},map:t,title:e.name||"Hely",icon:getIconByType(e.slug)})})}).catch(e=>console.error("Hiba a helyek betöltésekor:",e))}}function getIconByType(e){return"undefined"!=typeof cspm_nearby_map&&cspm_nearby_map.place_markers_file_url?cspm_nearby_map.place_markers_file_url+e+".png":null}function getCustomTypesFromJSON(e){let t=new Map;return e.forEach(e=>{e.slug&&e.type&&!t.has(e.slug)&&t.set(e.slug,e.type)}),t}function renderCustomTypeFilter(e){var t=document.querySelector("#cspm-filter");if(t){e=getCustomTypesFromJSON(e);let o='<select id="custom-type-selector"><option value="">– Összes típus –</option>';e.forEach((e,t)=>{o+=`<option value="${t}">${e}</option>`}),o+="</select>",t.innerHTML=o,document.querySelector("#custom-type-selector").addEventListener("change",function(){showFilteredLocations(this.value)})}}function showFilteredLocations(t){var e;document.querySelector("#cspm-map")&&void 0!==customLocations&&(e=t?customLocations.filter(e=>e.slug===t):customLocations,cspm_clearAllMarkers(),e.forEach(e=>{cspm_addMarker(e.lat,e.lng,e.name,e.slug)}))}document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof google&&google.maps&&initCustomNearbyMap()});
